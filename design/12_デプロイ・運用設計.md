# デプロイ・運用設計

## GitHub Pages デプロイ設計

### リポジトリ構成
```
habitengineer-website (GitHub Repository)
├── main ブランチ                    ← 本番環境
├── develop ブランチ                 ← 開発環境
└── feature/* ブランチ               ← 機能開発
```

### GitHub Actions ワークフロー
```yaml
# .github/workflows/deploy.yml
name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Ruby
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: '3.0'
        bundler-cache: true
        
    - name: Build site
      run: bundle exec jekyll build
      
    - name: Test site
      run: |
        bundle exec htmlproofer ./_site --disable-external
        
    - name: Deploy to GitHub Pages
      if: github.ref == 'refs/heads/main'
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./_site
```

## ドメイン設定

### カスタムドメイン
```
# CNAME ファイル
habitengineer.com
```

### DNS設定
```
Type    Name    Value
A       @       185.199.108.153
A       @       185.199.109.153
A       @       185.199.110.153
A       @       185.199.111.153
CNAME   www     habitengineer.com
```

## SSL/HTTPS設定
- GitHub Pages 自動SSL証明書
- Let's Encrypt 証明書
- HTTPS リダイレクト強制

## コンテンツ管理フロー

### ブログ記事投稿
```
1. ローカルで記事作成
   ├── _posts/2025-01-01-title.md
   └── 記事内容をMarkdownで記述

2. プレビュー確認
   └── bundle exec jekyll serve

3. Git push
   ├── git add .
   ├── git commit -m "新記事: タイトル"
   └── git push origin main

4. 自動デプロイ
   └── GitHub Actions が自動実行
```

### ページ更新フロー
```
1. 該当ページ (.md) を編集
2. ローカルでプレビュー確認
3. Git push で自動デプロイ
```

## バックアップ・復旧

### バックアップ対象
```
- 全ソースコード (GitHub)
- 画像・アセット (GitHub LFS)
- _config.yml 設定
- _data/ データファイル
```

### 復旧手順
```
1. GitHub からクローン
2. Ruby/Jekyll 環境構築
3. bundle install
4. 本番デプロイ
```

## 監視・分析

### アクセス解析
```
- Google Analytics 4
- Google Search Console
- PageSpeed Insights
```

### 監視項目
```
- サイト稼働状況
- ページ表示速度
- 検索順位
- エラー404発生
```

## 更新・メンテナンス

### 定期メンテナンス
```
月次:
- Jekyll / Ruby バージョン確認
- プラグイン更新確認
- セキュリティ更新確認

四半期:
- パフォーマンス測定
- SEO順位確認
- アクセス解析レビュー
```

### 緊急時対応
```
1. サイトダウン時
   ├── GitHub Pages Status 確認
   ├── DNS設定確認
   └── 最新コミット確認

2. 表示不具合時
   ├── ローカル環境で再現確認
   ├── 問題箇所特定
   └── Hotfix デプロイ
```